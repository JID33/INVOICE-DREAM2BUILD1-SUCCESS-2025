<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facture - DREAM2BUILT1</title>
    <!-- Styles CSS pour la mise en page de la facture -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .invoice-container {
            max-width: 800px;
            width: 100%;
            margin: 20px;
            padding: 30px;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }
        .header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 20px;
            margin-bottom: 15px; /* Espace réduit */
        }
        .header .logo-container {
            flex: 1;
            min-width: 150px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        /* Style pour la zone de téléchargement de logo */
        .logo-upload {
            cursor: pointer;
            position: relative;
            display: block;
            width: 150px;
            height: auto;
            border: 2px dashed #ccc;
            border-radius: 8px;
            overflow: hidden;
            text-align: center;
            transition: border-color 0.3s ease;
        }
        .logo-upload:hover {
            border-color: #3498db;
        }
        .logo-upload img {
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            transition: opacity 0.3s ease;
        }
        .logo-upload .upload-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #888;
            font-size: 14px;
            z-index: 1;
            display: none;
        }
        .logo-upload.empty .upload-text {
            display: block;
        }
        .logo-upload.empty img {
            opacity: 0.2;
        }
        .remove-logo-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            margin-top: 5px;
            display: none; /* Masqué par défaut */
        }
        .header .company-info {
            flex: 2;
            text-align: right;
            min-width: 250px;
        }
        .header .company-info h1 {
            margin: 0;
            font-size: 28px;
            color: #2c3e50;
        }
        .header .company-info p {
            margin: 5px 0 0;
            font-size: 14px;
            color: #7f8c8d;
        }
        /* Style pour les champs de saisie */
        .invoice-details, .client-info, .payment-terms {
            margin-bottom: 15px; /* Espace réduit */
            line-height: 1.5; /* Espace de ligne réduit */
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
        }
        .invoice-details div, .client-info div {
            margin-bottom: 4px; /* Espace réduit */
        }
        .invoice-details span, .client-info span {
            font-weight: bold;
            color: #34495e;
        }
        /* Style pour les champs de saisie */
        .invoice-details input[type="text"],
        .invoice-details input[type="date"],
        .client-info input[type="text"],
        .total-summary input:not(.currency-input) {
            border: 1px solid #ccc;
            padding: 5px 8px;
            border-radius: 4px;
            font-family: inherit;
            width: 100%;
            box-sizing: border-box;
        }
        .company-info input[type="text"] {
            text-align: right;
            margin: 2px 0;
        }
        #companyName {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            background-color: transparent;
            border: none;
            text-align: right;
            width: auto;
            padding: 0;
        }
        .payment-terms input[type="text"] {
            border: 1px solid #ccc;
            padding: 5px 8px;
            border-radius: 4px;
            font-family: inherit;
            width: auto;
            box-sizing: border-box;
            margin-top: 5px;
        }
        .table-container {
            margin-top: 20px; /* Espace réduit */
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 10px; /* Espace réduit */
            border-bottom: 1px solid #e0e0e0;
        }
        thead th {
            background-color: #3498db;
            color: white;
            text-transform: uppercase;
            font-size: 14px;
        }
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tbody tr:hover {
            background-color: #e8f4f8;
        }
        .table-actions {
            text-align: right;
            margin-top: 10px;
        }
        .table-actions button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        .table-actions button:hover {
            background-color: #27ae60;
        }
        .total-summary {
            text-align: right;
            margin-top: 15px; /* Espace réduit */
            padding-top: 15px;
            border-top: 2px solid #34495e;
        }
        .total-summary div {
            padding: 5px 0; /* Espace réduit */
            font-size: 1.1em;
        }
        .total-summary .total {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            padding-top: 15px;
            margin-top: 10px; /* Espace réduit */
        }
        .payment-terms {
            margin-top: 20px; /* Espace réduit */
            border-top: 1px solid #ddd;
            padding-top: 15px; /* Espace réduit */
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
        }
        .payment-terms h3 {
            color: #34495e;
            margin-bottom: 10px; /* Espace réduit */
            font-size: 18px;
        }
        .payment-terms p {
            margin: 5px 0;
        }
        .payment-terms ul {
            list-style: none;
            padding: 0;
        }
        .payment-terms ul li {
            margin-bottom: 8px;
            color: #555;
        }
        .footer {
            margin-top: 20px; /* Espace réduit */
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
            display: flex; /* Utiliser flexbox */
            flex-direction: column; /* Organiser en colonne */
            align-items: center; /* Centrer horizontalement */
            position: relative; /* Pour positionner le menu déroulant */
        }
        /* Style pour le nouveau textarea du footer */
        #footerTextarea {
            width: 100%;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            text-align: center;
        }
        /* Styles pour les petits boutons d'action au pied de page */
        .actions {
            position: fixed; /* Position fixe par rapport à la fenêtre */
            bottom: 20px;    /* 20px du bas */
            right: 20px;     /* 20px de la droite */
            display: flex;
            gap: 10px;       /* Espacement entre les boutons */
            z-index: 1000;   /* S'assurer que les boutons sont au-dessus des autres éléments */
        }
        .actions button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px; /* Rendre le padding plus petit */
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em; /* Rendre la police plus petite */
            transition: background-color 0.3s ease;
        }
        .actions button:hover {
            background-color: #2980b9;
        }
        .remove-row-btn {
            background-color: #e74c4c;
        }
        .remove-row-btn:hover {
            background-color: #c0392b;
        }
        .currency-input {
            width: 50px;
            text-align: center;
            margin-left: 5px;
            border: 1px solid #ccc;
            padding: 5px 8px;
            border-radius: 4px;
        }
        .total-amount-row {
            text-align: right;
        }
        /* Style pour le menu déroulant de langue */
        .language-select-footer {
            position: absolute; /* Positionnement absolu dans le footer */
            bottom: 0; /* Aligné au bas du footer */
            right: 0; /* Aligné à droite du footer */
            padding: 2px;
            font-size: 12px;
            border-radius: 4px;
            background-color: #ecf0f1;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        /* NOUVEAUX STYLES POUR LE TEXTAREA DYNAMIQUE */
        .description-textarea {
            width: 100%;
            border: 1px solid #ccc;
            padding: 5px 8px;
            border-radius: 4px;
            font-family: inherit;
            box-sizing: border-box;
            resize: none; /* Empêche le redimensionnement manuel par l'utilisateur */
            overflow: hidden; /* Cache la barre de défilement */
            min-height: 40px; /* Hauteur minimale d'un input normal */
        }

        /* Styles responsifs pour les petits écrans */
        @media (max-width: 600px) {
            .invoice-container {
                padding: 15px;
                margin: 10px;
            }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header .company-info {
                text-align: center;
                margin-top: 15px;
            }
            .header .logo-container {
                align-items: center;
            }
            .header img {
                margin-bottom: 10px;
            }
            th, td {
                padding: 10px;
            }
            .total-summary {
                text-align: center;
            }
            .actions {
                justify-content: center;
                right: 0;
                left: 0;
                bottom: 10px;
                gap: 5px;
            }
            .actions button {
                margin: 0 2px;
                padding: 6px 10px;
            }
            .language-select-footer {
                position: static; /* Positionnement statique sur mobile */
                margin-top: 10px; /* Ajouter une marge pour l'espacement */
                width: 100%; /* Occupe toute la largeur */
                text-align: center;
            }
        }
        /* Masquer les boutons lors de l'impression et ajuster les marges pour économiser de l'espace */
        @media print {
            /* Définit la taille de la page à 8.5 x 11 pouces (US Letter) */
            @page {
                size: 8.5in 11in;
                margin: 0.5in;
            }
            /* C'est ici que l'élément est masqué */
            .actions, .table-actions, .logo-upload, .remove-logo-btn, .language-select-footer {
                display: none;
            }
            input, textarea {
                border: none;
                padding: 0;
            }
            body {
                padding: 0;
                margin: 0;
            }
            .invoice-container {
                width: 100%;
                max-width: 100%;
                box-shadow: none;
                border: none;
                margin: 0;
                padding: 0;
            }
            .header, .invoice-details, .client-info, .payment-terms, .total-summary, .footer {
                margin-bottom: 10px; /* Réduire l'espacement vertical */
            }
            th, td {
                padding: 8px; /* Réduire le padding des cellules de tableau */
            }
            .total-summary input[type="number"] {
                width: 100px !important;
            }
        }
    </style>
</head>
<body>

<div class="invoice-container">
    <div class="header">
        <div class="logo-container">
            <!-- Zone de téléchargement de logo -->
            <label for="logoInput" class="logo-upload empty">
                <img id="logoImage" src="" alt="Logo de l'entreprise">
                <span class="upload-text">Cliquer pour ajouter un logo</span>
            </label>
            <input type="file" id="logoInput" accept="image/*" style="display: none;">
            <button id="removeLogoButton" class="remove-logo-btn" onclick="removeLogo()">Supprimer le logo</button>
        </div>
        <div class="company-info">
            <input type="text" id="companyName" value="DREAM2BUILT1">
            <input type="text" id="companySlogan" value="Slogan: Invest to Win More">
            <input type="text" id="companyAddress" value="123 Rue de l'Innovation">
            <input type="text" id="companyCity" value="Port-au-Prince, HT 6110, Haïti">
            <input type="text" id="companyPhone" value="+509 1234 5678">
            <input type="text" id="companyEmail" value="contact@dream2built1.com">
            <input type="text" id="companyWebsite" value="www.dream2built1.com">
        </div>
    </div>

    <div class="invoice-details">
        <div>
            <span data-lang="invoice-number">FACTURE N° :</span>
            <input type="text" id="invoiceNumber" value="INV-2025-08-06-0001">
        </div>
        <div>
            <span data-lang="invoice-date">Date de facturation :</span>
            <input type="date" id="invoiceDate" value="2025-08-06">
        </div>
        <div>
            <span data-lang="due-date">Date d'échéance :</span>
            <input type="date" id="dueDate" value="2025-08-20">
        </div>
    </div>

    <div class="client-info">
        <h3 data-lang="bill-to">Facture à :</h3>
        <input type="text" id="clientName" value="Nom du Client">
        <input type="text" id="clientCompany" value="Nomdel'EntrepriseduClient">
        <input type="text" id="clientAddress" value="123 Avenue du Progrès">
        <input type="text" id="clientCity" value="Pétion-Ville, HT 6120, Haïti">
        <input type="text" id="clientPhone" value="+509 9876 5432">
        <input type="text" id="clientEmail" value="client@email.com">
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th data-lang="description">Description</th>
                    <th data-lang="quantity">Quantité</th>
                    <th data-lang="unit-price">Prix unitaire</th>
                    <th data-lang="actions">Actions</th>
                </tr>
            </thead>
            <tbody id="invoiceTableBody">
                <!-- Les lignes de la table seront ajoutées ici par JavaScript -->
            </tbody>
        </table>
        <div class="table-actions">
            <button onclick="addRow()" data-lang="add-row-button">Ajouter une ligne</button>
        </div>
    </div>

    <div class="total-summary">
        <div><span data-lang="currency-symbol-label">Symbole de la devise :</span> <input type="text" class="currency-input" id="currencySymbolInput" value="$"></div>
        <div><span id="subtotalLabel" data-lang="subtotal">Sous-total :</span> <span id="subtotal">0.00</span> <span class="currencySymbol"></span></div>
        <div><span data-lang="global-tax-rate">Taux de taxe global (%) :</span> <input type="number" id="globalTaxRate" value="0" min="0" step="0.01" style="width: 100px; text-align: center;"></div>
        <div><span id="totalTaxLabel" data-lang="total-tax">Taxe Totale :</span> <span id="totalTax">0.00</span> <span class="currencySymbol"></span></div>
        <div class="total"><span id="grandTotalLabel" data-lang="grand-total">Montant total :</span> <span id="grandTotal">0.00</span> <span class="currencySymbol"></span></div>
        <div><span id="amountReceivedLabel" data-lang="amount-received">Montant reçu :</span> <input type="number" id="amountReceived" value="0" min="0" step="0.01" style="width: 100px; text-align: center;"> <span class="currencySymbol"></span></div>
        <div class="total"><span id="balanceDueLabel" data-lang="balance-due">Reste à payer :</span> <span id="totalDue">0.00</span> <span class="currencySymbol"></span></div>
    </div>

    <div class="payment-terms">
        <h3 data-lang="payment-terms-title">Conditions de paiement</h3>
        <p>
            <span data-lang="payment-due-date-text">Veuillez effectuer le paiement au plus tard le</span> <input type="text" id="dynamicDueDateText" value="20/08/2025" style="width: 100px; text-align: center;">.
        </p>
        <textarea id="paymentMethods" rows="4">
Méthodes de paiement acceptées :
- Virement bancaire (Compte #1234567890, Banque Nationale de Crédit)
- Paiement mobile (Moncash: +509 1234 5678, Natcash: +509 9876 5432)</textarea>
    </div>

    <div class="footer">
        <textarea id="footerTextarea" rows="2" data-lang="footer-text">
Merci pour votre confiance ! Nous sommes impatients de vous accompagner dans la construction de vos rêves.</textarea>
        <!-- Nouveau menu déroulant pour la traduction -->
        <select id="language-select" class="language-select-footer">
            <option value="fr">Français</option>
            <option value="en">English</option>
            <option value="ht">Kreyòl Ayisyen</option>
            <option value="es">Español</option>
        </select>
    </div>
</div>

<!-- Boutons d'action déplacés et redimensionnés -->
<div class="actions">
    <button onclick="saveInvoice()">Sauvegarder la facture</button>
    <button onclick="generateNewInvoice()">Générer une nouvelle facture</button>
    <button onclick="window.print()">Imprimer la facture</button>
</div>

<script>
    // Objet de traduction
    const translations = {
        'en': {
            'title': 'Invoice - DREAM2BUILT1',
            'save-button': 'Save Invoice',
            'generate-button': 'Generate New Invoice',
            'print-button': 'Print Invoice',
            'logo-upload-text': 'Click to add a logo',
            'remove-logo-button': 'Remove Logo',
            'invoice-number': 'INVOICE N° :',
            'invoice-date': 'Invoice Date :',
            'due-date': 'Due Date :',
            'bill-to': 'Bill to :',
            'description': 'Description',
            'quantity': 'Quantity',
            'unit-price': 'Unit Price',
            'actions': 'Actions',
            'add-row-button': 'Add Row',
            'currency-symbol-label': 'Currency Symbol:',
            'subtotal': 'Subtotal :',
            'global-tax-rate': 'Global Tax Rate (%) :',
            'total-tax': 'Total Tax :',
            'grand-total': 'Grand Total :',
            'amount-received': 'Amount Received :',
            'balance-due': 'Balance Due :',
            'payment-terms-title': 'Payment Terms',
            'payment-due-date-text': 'Please make the payment by',
            'payment-methods': `Accepted payment methods:
- Bank transfer (Account #1234567890, Bank National Credit)
- Mobile payment (Moncash: +509 1234 5678, Natcash: +509 9876 5432)`,
            'footer-text': 'Thank you for your trust! We look forward to helping you build your dreams.',
            'default-items': [
                { desc: 'Registration fees for "Dream2Built1" training', qty: 1, price: 100.00 },
                { desc: '"Invest to Win More" resource pack', qty: 1, price: 50.00 },
                { desc: 'Revival fee (Applicable after the first 10 people)', qty: 1, price: 100.00 },
                { desc: 'Annual participation fee (after 6 months)', qty: 1, price: 500.00 }
            ],
            'client-name': 'Client Name',
            'client-company': 'Client Company Name',
        },
        'fr': {
            'title': 'Facture - DREAM2BUILT1',
            'save-button': 'Sauvegarder la facture',
            'generate-button': 'Générer une nouvelle facture',
            'print-button': 'Imprimer la facture',
            'logo-upload-text': 'Cliquer pour ajouter un logo',
            'remove-logo-button': 'Supprimer le logo',
            'invoice-number': 'FACTURE N° :',
            'invoice-date': 'Date de facturation :',
            'due-date': 'Date d\'échéance :',
            'bill-to': 'Facture à :',
            'description': 'Description',
            'quantity': 'Quantité',
            'unit-price': 'Prix unitaire',
            'actions': 'Actions',
            'add-row-button': 'Ajouter une ligne',
            'currency-symbol-label': 'Symbole de la devise :',
            'subtotal': 'Sous-total :',
            'global-tax-rate': 'Taux de taxe global (%) :',
            'total-tax': 'Taxe Totale : ',
            'grand-total': 'Montant total : ',
            'amount-received': 'Montant reçu :',
            'balance-due': 'Reste à payer :',
            'payment-terms-title': 'Conditions de paiement',
            'payment-due-date-text': 'Veuillez effectuer le paiement au plus tard le',
            'payment-methods': `Méthodes de paiement acceptées :
- Virement bancaire (Compte #1234567890, Banque Nationale de Crédit)
- Paiement mobile (Moncash: +509 1234 5678, Natcash: +509 9876 5432)`,
            'footer-text': 'Merci pour votre confiance ! Nous sommes impatients de vous accompagner dans la construction de vos rêves.',
            'default-items': [
                { desc: 'Frais d\'inscription pour la formation "Dream2Built1"', qty: 1, price: 100.00 },
                { desc: 'Pack de ressources "Invest to Win More"', qty: 1, price: 50.00 },
                { desc: 'Frais de relance (Applicable après 10 premières personnes)', qty: 1, price: 100.00 },
                { desc: 'Frais de participation annuelle (après 6 mois)', qty: 1, price: 500.00 }
            ],
            'client-name': 'Nom du Client',
            'client-company': 'Nomdel\'EntrepriseduClient',
        },
        'ht': {
            'title': 'Fakti - DREAM2BUILT1',
            'save-button': 'Sove Fakti',
            'generate-button': 'Jenere yon nouvo fakti',
            'print-button': 'Enprime Fakti',
            'logo-upload-text': 'Klike pou mete yon logo',
            'remove-logo-button': 'Retire Logo a',
            'invoice-number': 'FAKTI N° :',
            'invoice-date': 'Dat Fakti :',
            'due-date': 'Dat Echeyans :',
            'bill-to': 'Fakti pou :',
            'description': 'Deskripsyon',
            'quantity': 'Kantite',
            'unit-price': 'Pri Inite',
            'actions': 'Aksyon',
            'add-row-button': 'Ajoute yon liy',
            'currency-symbol-label': 'Senbòl lajan :',
            'subtotal': 'Sou-total :',
            'global-tax-rate': 'Taks Global (%) :',
            'total-tax': 'Total Taks :',
            'grand-total': 'Montan total :',
            'amount-received': 'Montan resevwa :',
            'balance-due': 'Rès pou peye :',
            'payment-terms-title': 'Kondisyon peman',
            'payment-due-date-text': 'Tanpri fè peman an avan',
            'payment-methods': `Metòd peman yo aksepte :
- Transfè labank (Kont #1234567890, Bank Nasyonal Kredi)
- Peman mobil (Moncash: +509 1234 5678, Natcash: +509 9876 5432)`,
            'footer-text': 'Mèsi pou konfyans ou! Nou kontan pou ede ou bati rèv ou.',
            'default-items': [
                { desc: 'Frè enskripsyon pou fòmasyon "Dream2Built1"', qty: 1, price: 100.00 },
                { desc: 'Pak resous "Invest to Win More"', qty: 1, price: 50.00 },
                { desc: 'Frè relans (aplike apre 10 premye moun yo)', qty: 1, price: 100.00 },
                { desc: 'Frè patisipasyon anyèl (apre 6 mwa)', qty: 1, price: 500.00 }
            ],
            'client-name': 'Non Kliyan',
            'client-company': 'Non Konpayi Kliyan an',
        },
        'es': {
            'title': 'Factura - DREAM2BUILT1',
            'save-button': 'Guardar Factura',
            'generate-button': 'Generar nueva factura',
            'print-button': 'Imprimir Factura',
            'logo-upload-text': 'Haga clic para agregar un logo',
            'remove-logo-button': 'Quitar logo',
            'invoice-number': 'FACTURA N° :',
            'invoice-date': 'Fecha de la factura :',
            'due-date': 'Fecha de vencimiento :',
            'bill-to': 'Facturar a :',
            'description': 'Descripción',
            'quantity': 'Cantidad',
            'unit-price': 'Precio unitario',
            'actions': 'Acciones',
            'add-row-button': 'Añadir fila',
            'currency-symbol-label': 'Símbolo de moneda:',
            'subtotal': 'Subtotal :',
            'global-tax-rate': 'Tasa de impuestos global (%) :',
            'total-tax': 'Impuesto total :',
            'grand-total': 'Cantidad total :',
            'amount-received': 'Cantidad recibida :',
            'balance-due': 'Saldo pendiente :',
            'payment-terms-title': 'Condiciones de pago',
            'payment-due-date-text': 'Por favor, realice el pago a más tardar el',
            'payment-methods': `Métodos de pago aceptados:
- Transferencia bancaria (Cuenta #1234567890, Banco Nacional de Crédito)
- Pago móvil (Moncash: +509 1234 5678, Natcash: +509 9876 5432)`,
            'footer-text': '¡Gracias por su confianza! Esperamos poder ayudarle a construir sus sueños.',
            'default-items': [
                { desc: 'Tarifas de inscripción para la formación "Dream2Built1"', qty: 1, price: 100.00 },
                { desc: 'Paquete de recursos "Invest to Win More"', qty: 1, price: 50.00 },
                { desc: 'Tarifa de reactivación (aplicable después de las primeras 10 personas)', qty: 1, price: 100.00 },
                { desc: 'Tarifa de participación anual (después de 6 meses)', qty: 1, price: 500.00 }
            ],
            'client-name': 'Client Name',
            'client-company': 'Client Company Name',
        }
    };
    
    let currentLanguage = 'fr'; // Langue par défaut
    
    // Fonction pour ajuster la hauteur de la zone de texte
    function adjustTextareaHeight(textarea) {
        // Remise à zéro de la hauteur pour obtenir la hauteur de défilement correcte
        textarea.style.height = 'auto';
        // Définition de la hauteur de la zone de texte en fonction de son contenu
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    // Fonction pour mettre à jour les symboles de la devise
    function updateCurrencySymbol() {
        const currencySymbol = document.getElementById('currencySymbolInput').value;
        document.querySelectorAll('.currencySymbol').forEach(element => {
            element.textContent = currencySymbol;
        });
    }

    // Fonction pour mettre à jour la langue de l'interface
    function setLanguage(lang) {
        currentLanguage = lang;
        const translation = translations[lang];

        // Mettre à jour le titre de la page
        document.title = translation.title;
        
        // Mettre à jour le sélecteur de langue pour qu'il reflète le changement
        document.getElementById('language-select').value = lang;

        // Mettre à jour les textes des boutons principaux
        const actionButtons = document.querySelectorAll('.actions button');
        if (actionButtons.length >= 3) {
            actionButtons[0].textContent = translation['save-button'];
            actionButtons[1].textContent = translation['generate-button'];
            actionButtons[2].textContent = translation['print-button'];
        }

        // Mettre à jour les textes des éléments avec l'attribut data-lang
        document.querySelectorAll('[data-lang]').forEach(element => {
            const key = element.getAttribute('data-lang');
            if (translation[key]) {
                // Pour le textarea du footer, on met à jour la valeur
                if (element.tagName === 'TEXTAREA') {
                    element.value = translation[key];
                } else {
                    element.textContent = translation[key];
                }
            }
        });
        
        // Mettre à jour les valeurs par défaut des inputs (client info)
        document.getElementById('clientName').value = translation['client-name'];
        document.getElementById('clientCompany').value = translation['client-company'];

        // Mettre à jour le placeholder du logo
        document.querySelector('.logo-upload .upload-text').textContent = translation['logo-upload-text'];
        document.getElementById('removeLogoButton').textContent = translation['remove-logo-button'];

        // Mettre à jour les titres de la table
        const tableHeaders = document.querySelectorAll('thead th');
        tableHeaders[0].textContent = translation['description'];
        tableHeaders[1].textContent = translation['quantity'];
        tableHeaders[2].textContent = translation['unit-price'];
        tableHeaders[3].textContent = translation['actions'];

        // Mettre à jour le texte du bouton d'ajout de ligne
        document.querySelector('.table-actions button').textContent = translation['add-row-button'];
        
        // Mettre à jour le texte du bouton de suppression de ligne pour les lignes existantes
        document.querySelectorAll('.remove-row-btn').forEach(btn => btn.textContent = lang === 'fr' ? 'Supprimer' : lang === 'ht' ? 'Retire' : lang === 'es' ? 'Eliminar' : 'Remove');

        // Mettre à jour le contenu de la zone de texte des méthodes de paiement
        document.getElementById('paymentMethods').value = translation['payment-methods'].trim();
        
        // Mettre à jour le texte du footer
        document.getElementById('footerTextarea').value = translation['footer-text'].trim();
        
        // Mettre à jour le symbole de la devise affiché
        updateCurrencySymbol();
    }

    // Gérer le changement de logo
    document.getElementById('logoInput').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('logoImage').src = e.target.result;
                document.getElementById('removeLogoButton').style.display = 'block';
                document.querySelector('.logo-upload').classList.remove('empty');
            };
            reader.readAsDataURL(file);
        }
    });

    // Supprimer le logo
    function removeLogo() {
        document.getElementById('logoImage').src = '';
        document.getElementById('removeLogoButton').style.display = 'none';
        document.querySelector('.logo-upload').classList.add('empty');
        // Réinitialiser l'input file pour pouvoir re-sélectionner le même fichier
        document.getElementById('logoInput').value = '';
    }

    // Fonction pour sauvegarder la facture en tant que fichier HTML
    function saveInvoice() {
        // Crée une copie du document actuel pour le nettoyage
        const invoiceCopy = document.documentElement.cloneNode(true);

        // Supprime les boutons d'action du document copié pour avoir une version propre
        const actionElements = invoiceCopy.querySelectorAll('.actions, .table-actions, .remove-logo-btn, .logo-upload, .language-buttons');
        actionElements.forEach(el => el.parentNode.removeChild(el));

        // Rendre les champs de saisie en texte statique
        const inputs = invoiceCopy.querySelectorAll('input[type="text"], input[type="date"], input[type="number"]');
        inputs.forEach(input => {
            const span = invoiceCopy.createElement('span');
            span.textContent = input.value;
            input.parentNode.replaceChild(span, input);
        });

        const textareas = invoiceCopy.querySelectorAll('textarea');
        textareas.forEach(textarea => {
            const pre = invoiceCopy.createElement('pre');
            pre.textContent = textarea.value;
            textarea.parentNode.replaceChild(pre, textarea);
        });
        
        // Crée le contenu HTML de la facture sauvegardée
        const htmlContent = `<!DOCTYPE html>${invoiceCopy.outerHTML}`;
        const blob = new Blob([htmlContent], { type: 'text/html' });

        // Crée un lien de téléchargement et le déclenche
        const a = document.createElement('a');
        const url = URL.createObjectURL(blob);
        const invoiceNumber = document.getElementById('invoiceNumber').value;
        a.href = url;
        a.download = `facture-${invoiceNumber}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Fonction pour obtenir la date actuelle au format YYYY-MM-DD
    function getCurrentDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Fonction pour générer un numéro de facture unique
    function generateInvoiceNumber() {
        const date = getCurrentDate();
        const randomNum = Math.floor(1000 + Math.random() * 9000); // Nombre aléatoire à 4 chiffres
        return `INV-${date}-${randomNum}`;
    }

    // Fonction pour ajouter une ligne au tableau
    function addRow(description = '', quantity = 1, price = 0) {
        const tableBody = document.getElementById('invoiceTableBody');
        const newRow = document.createElement('tr');
        
        const removeButtonText = currentLanguage === 'fr' ? 'Supprimer' : currentLanguage === 'ht' ? 'Retire' : currentLanguage === 'es' ? 'Eliminar' : 'Remove';

        newRow.innerHTML = `
            <td><textarea class="description-textarea" rows="1">${description}</textarea></td>
            <td><input type="number" class="quantity" value="${quantity}" min="0"></td>
            <td><input type="number" class="price" value="${price}" min="0" step="0.01"></td>
            <td><button class="remove-row-btn" onclick="removeRow(this)">${removeButtonText}</button></td>
        `;

        tableBody.appendChild(newRow);

        // Ajout des écouteurs d'événements aux nouvelles entrées
        const inputs = newRow.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener('input', calculateTotals);
        });
        
        // Ajout d'un écouteur d'événement au textarea pour l'agrandissement dynamique
        const textarea = newRow.querySelector('.description-textarea');
        textarea.addEventListener('input', () => adjustTextareaHeight(textarea));
        
        // Mise à jour des totaux après l'ajout de la ligne
        calculateTotals();
    }

    // Fonction pour supprimer une ligne
    function removeRow(button) {
        const row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
        calculateTotals();
    }

    // Fonction pour calculer les totaux
    function calculateTotals() {
        const rows = document.querySelectorAll('#invoiceTableBody tr');
        let subtotal = 0;

        rows.forEach(row => {
            const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
            const price = parseFloat(row.querySelector('.price').value) || 0;
            
            const lineTotal = quantity * price;
            subtotal += lineTotal;
        });

        const globalTaxRate = parseFloat(document.getElementById('globalTaxRate').value) || 0;
        const totalTax = subtotal * (globalTaxRate / 100);
        const grandTotal = subtotal + totalTax;
        const amountReceived = parseFloat(document.getElementById('amountReceived').value) || 0;
        
        const remainingDue = grandTotal - amountReceived;
        
        document.getElementById('subtotal').textContent = subtotal.toFixed(2);
        document.getElementById('totalTax').textContent = totalTax.toFixed(2);
        document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
        document.getElementById('totalDue').textContent = remainingDue.toFixed(2);

        // Si le montant dû est 0 ou moins, on peut le mettre en évidence
        if (remainingDue <= 0) {
            document.getElementById('totalDue').style.color = '#27ae60'; // Green
        } else {
            document.getElementById('totalDue').style.color = '#e74c3c'; // Red
        }
    }

    // Fonction pour mettre à jour la date d'échéance dans le texte
    function updateDueDateText() {
        const dueDateInput = document.getElementById('dueDate');
        const dynamicDueDateTextInput = document.getElementById('dynamicDueDateText');
        if (dueDateInput && dynamicDueDateTextInput) {
            const date = new Date(dueDateInput.value);
            const formattedDate = date.toLocaleDateString(currentLanguage, { day: '2-digit', month: '2-digit', year: 'numeric' });
            dynamicDueDateTextInput.value = formattedDate;
        }
    }

    // Fonction pour générer une nouvelle facture (bouton "Générer")
    function generateNewInvoice() {
        const invoiceNumberInput = document.getElementById('invoiceNumber');
        const invoiceDateInput = document.getElementById('invoiceDate');
        const dueDateInput = document.getElementById('dueDate');
        const tableBody = document.getElementById('invoiceTableBody');
        const paymentMethodsTextarea = document.getElementById('paymentMethods');

        const translation = translations[currentLanguage];

        // Mettre à jour le numéro de facture
        invoiceNumberInput.value = generateInvoiceNumber();

        // Mettre à jour la date de facturation à la date du jour
        const currentDate = getCurrentDate();
        invoiceDateInput.value = currentDate;
        
        // Mettre à jour la date d'échéance à 14 jours de la date du jour
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + 14);
        const dueYear = dueDate.getFullYear();
        const dueMonth = String(dueDate.getMonth() + 1).padStart(2, '0');
        const dueDay = String(dueDate.getDate()).padStart(2, '0');
        dueDateInput.value = `${dueYear}-${dueMonth}-${dueDay}`;
        updateDueDateText();

        // Réinitialiser le tableau
        tableBody.innerHTML = '';
        
        // Ajouter les lignes initiales avec les valeurs par défaut de la langue
        translation['default-items'].forEach(item => {
            addRow(item.desc, item.qty, item.price);
        });

        // Réinitialiser le montant reçu
        document.getElementById('amountReceived').value = 0;
        
        // Réinitialiser le symbole de la devise
        document.getElementById('currencySymbolInput').value = '$';
        updateCurrencySymbol();
        
        // Réinitialiser le taux de taxe global
        document.getElementById('globalTaxRate').value = '0';

        // Réinitialiser le contenu du champ de texte
        paymentMethodsTextarea.value = translation['payment-methods'].trim();
        
        // Réinitialiser les champs de l'entreprise
        document.getElementById('companyName').value = 'DREAM2BUILT1';
        document.getElementById('companySlogan').value = 'Slogan: Invest to Win More';
        document.getElementById('companyAddress').value = '123 Rue de l\'Innovation';
        document.getElementById('companyCity').value = 'Port-au-Prince, HT 6110, Haïti';
        document.getElementById('companyPhone').value = '+509 1234 5678';
        document.getElementById('companyEmail').value = 'contact@dream2built1.com';
        document.getElementById('companyWebsite').value = 'www.dream2built1.com';
        
        // Réinitialiser les champs du client
        document.getElementById('clientName').value = translation['client-name'];
        document.getElementById('clientCompany').value = translation['client-company'];

        // Réinitialiser le logo à la valeur par défaut
        removeLogo();

        // Calculer les totaux initiaux
        calculateTotals();
    }

    // Appel de la fonction pour générer une nouvelle facture au chargement de la page
    document.addEventListener('DOMContentLoaded', () => {
        setLanguage('fr'); // Définir la langue par défaut sur le français
        generateNewInvoice();
    });

    // Ajout d'un écouteur d'événement au champ "Montant reçu" pour recalculer les totaux
    document.getElementById('amountReceived').addEventListener('input', calculateTotals);
    // Ajout d'un écouteur d'événement au champ "Taux de taxe global" pour recalculer les totaux
    document.getElementById('globalTaxRate').addEventListener('input', calculateTotals);
    // Ajout d'un écouteur d'événement à la date d'échéance pour mettre à jour le texte
    document.getElementById('dueDate').addEventListener('change', updateDueDateText);
    // Ajout d'un écouteur d'événement pour mettre à jour le symbole de la devise
    document.getElementById('currencySymbolInput').addEventListener('input', updateCurrencySymbol);
    // Ajout d'un écouteur d'événement au menu déroulant de langue
    document.getElementById('language-select').addEventListener('change', (event) => {
        setLanguage(event.target.value);
    });
</script>

</body>
</html>
